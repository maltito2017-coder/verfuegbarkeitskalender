<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Gemeinsamer Kalender</title>
<style>
  body { font-family: sans-serif; }
  table { border-collapse: collapse; width: 100%; }
  td { border: 1px solid #ccc; width: 40px; height: 40px; text-align: center; vertical-align: middle; cursor: pointer; }
  .frei { background-color: white; }
  .feiertag { background-color: #ddd; }
</style>
</head>
<body>
<h1>Gemeinsamer Kalender</h1>
<label>Teilnehmer: 
  <select id="teilnehmer">
    <option value="person1" style="color:red;">Arne</option>
    <option value="person2" style="color:blue;">Malte</option>
    <option value="person3" style="color:green;">Roman</option>
    <option value="person4" style="color:orange;">Sascha</option>
    <option value="person5" style="color:purple;">Seb</option>
  </select>
</label>
<div id="kalender"></div>

<script>
const API_URL = window.location.origin + '/api';
const colors = {person1:'red', person2:'blue', person3:'green', person4:'orange', person5:'purple'};
const feiertage = {
  "NRW":["2026-05-01","2026-10-03"],
  "RLP":["2026-05-01"],
  "HH":["2026-05-01"],
  "BE":["2026-05-01"]
};
const startMonth = 4; // April
const endMonth = 10;  // Oktober
const year = 2026;

let markedData = {};

async function loadData() {
  const res = await fetch(API_URL);
  markedData = await res.json();
  renderKalender();
}

function renderKalender() {
  const container = document.getElementById('kalender');
  container.innerHTML = '';
  for(let m=startMonth; m<=endMonth; m++) {
    const firstDay = new Date(year,m-1,1);
    const lastDay = new Date(year,m,0);
    const table = document.createElement('table');
    const caption = document.createElement('caption');
    caption.textContent = firstDay.toLocaleString('de-DE',{month:'long', year:'numeric'});
    table.appendChild(caption);
    
    // Woche 1..6
    let tr = document.createElement('tr');
    for(let d=0; d<firstDay.getDay(); d++) tr.appendChild(document.createElement('td'));
    for(let day=1; day<=lastDay.getDate(); day++){
      const td = document.createElement('td');
      const dateStr = `${year}-${String(m).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
      td.textContent = day;
      td.className = 'frei';
      
      // Feiertag markieren
      for(let land in feiertage){
        if(feiertage[land].includes(dateStr)) td.className = 'feiertag';
      }

      // Markierung aus Daten
      for(let person in markedData){
        if(markedData[person] && markedData[person].includes(dateStr)){
          td.style.backgroundColor = colors[person];
        }
      }

      td.onclick = () => {
        const person = document.getElementById('teilnehmer').value;
        if(!markedData[person]) markedData[person]=[];
        if(markedData[person].includes(dateStr)){
          markedData[person] = markedData[person].filter(d=>d!==dateStr);
        } else {
          markedData[person].push(dateStr);
        }
        td.style.backgroundColor = markedData[person].includes(dateStr)? colors[person] : 'white';
        saveData();
      };

      tr.appendChild(td);
      if((day + firstDay.getDay())%7===0){
        table.appendChild(tr);
        tr=document.createElement('tr');
      }
    }
    table.appendChild(tr);
    container.appendChild(table);
  }
}

async function saveData(){
  await fetch(API_URL, {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(markedData)
  });
}

loadData();
</script>
</body>
</html>